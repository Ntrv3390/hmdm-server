<div ng-controller="WorkTimePoliciesController" class="worktime-wrapper">

  <style>
    .worktime-wrapper {
      margin-top: 20px;
    }

    .shadow-card {
      border-radius: 8px;
      border: none;
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);
    }

    .section {
      margin-bottom: 20px;
    }

    .section-title {
      margin-bottom: 15px;
      font-weight: 600;
      color: #444;
    }

    .day-toggle-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .day-toggle {
      min-width: 60px;
      border-radius: 20px;
      transition: all 0.2s ease;
    }

    .day-toggle:hover {
      transform: translateY(-1px);
    }

    .active-day {
      background-color: #337ab7;
      border-color: #2e6da4;
      color: white;
    }

    .form-actions {
      margin-top: 25px;
    }

    .panel-heading {
      background: #f7f9fc;
      border-bottom: 1px solid #e5e8ec;
      border-radius: 8px 8px 0 0;
    }

    .panel-title {
      font-weight: 600;
      font-size: 18px;
    }

    .panel-body {
      padding: 25px;
    }

    .form-control.input-lg {
      height: 45px;
      font-size: 16px;
    }
  </style>

  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs" role="tablist" style="margin-bottom: 20px;">
          <li role="presentation" class="active">
            <a href="/#/plugin-worktime" style="color: #337ab7; font-weight: 600;">Global Policy</a>
          </li>
          <li role="presentation">
            <a href="/#/plugin-worktime/users" style="color: #666; font-weight: 600;">User Exceptions</a>
          </li>
        </ul>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default shadow-card">

          <!-- Header -->
          <div class="panel-heading">
            <h3 class="panel-title">
              <i class="glyphicon glyphicon-time"></i>
              Global Work Time Policy
            </h3>
          </div>

          <div class="panel-body">

            <!-- Success Message -->
            <div class="alert alert-success" ng-if="success">
              <i class="glyphicon glyphicon-ok"></i> {{success}}
            </div>

            <!-- Error -->
            <div class="alert alert-danger" ng-if="error">
              <i class="glyphicon glyphicon-exclamation-sign"></i> {{error}}
            </div>

            <!-- Enabled Toggle -->
            <div class="form-group">
              <label class="control-label">Policy Enabled</label>
              <div>
                <label class="checkbox-inline">
                  <input type="checkbox" ng-model="policy.enabled"> Enable enforcement
                </label>
              </div>
            </div>
            <!-- Form -->
            <form class="form-horizontal" ng-if="policy">

              <!-- Time Section -->
              <div class="section">
                <h4 class="section-title">Working Hours</h4>

                <div class="row">
                  <div class="col-sm-6">
                    <label>Start time</label>
                    <input
                      type="text"
                      class="form-control input-lg"
                      ng-model="policy.startTime"
                      placeholder="HH:mm">
                  </div>

                  <div class="col-sm-6">
                    <label>End time</label>
                    <input
                      type="text"
                      class="form-control input-lg"
                      ng-model="policy.endTime"
                      placeholder="HH:mm">
                  </div>
                </div>
              </div>

              <hr>

              <!-- Days Section -->
              <div class="section">
                <h4 class="section-title">Working Days</h4>

                <div class="day-toggle-group">
                  <button
                    type="button"
                    class="btn day-toggle"
                    ng-repeat="day in days"
                    ng-class="{'btn-primary active-day': hasDay(day.id)}"
                    ng-click="toggleDay(day.id)">
                    {{day.label}}
                  </button>
                </div>
              </div>

              <hr>

              <!-- Allowed Apps -->
              <div class="section">
                <h4 class="section-title">App Access Rules</h4>

                <div class="form-group">
                  <label>Allowed during work <span class="badge">{{countSelected(selectedAppsDuringWork)}}</span></label>
                  <p class="help-block" style="margin-top: 5px; margin-bottom: 10px;">
                    Select apps that can be used during work hours, or select "All Apps" to allow everything.
                  </p>
                  
                  <div ng-if="appsLoading" style="text-align: center; padding: 20px;">
                    <i class="fa fa-spinner fa-spin" style="font-size: 24px;"></i>
                    <p>Loading applications...</p>
                  </div>
                  
                  <div ng-if="!appsLoading">
                    <!-- Search box -->
                    <input 
                      type="text" 
                      class="form-control" 
                      ng-model="duringWorkSearchText" 
                      placeholder="Search apps..."
                      style="margin-bottom: 10px;">
                    
                    <!-- App list container -->
                    <div style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px; background: #fafafa;">
                      <!-- All apps option -->
                      <label class="checkbox" style="margin-bottom: 8px; padding: 8px; background: #fff; border-radius: 4px; display: block; cursor: pointer;">
                        <input 
                          type="checkbox" 
                          ng-model="selectedAppsDuringWork['*']" 
                          ng-change="toggleAllAppsDuringWork()">
                        <strong style="margin-left: 5px;">All Apps</strong>
                      </label>
                      
                      <hr style="margin: 10px 0;">
                      
                      <!-- Individual apps -->
                      <div ng-if="applications.length === 0" style="padding: 20px; text-align: center; color: #999;">
                        No applications found
                      </div>
                      
                      <label 
                        class="checkbox" 
                        ng-repeat="app in getFilteredAppsDuringWork()"
                        style="margin-bottom: 5px; padding: 8px; background: #fff; border-radius: 4px; display: block; cursor: pointer;"
                        ng-class="{'text-muted': selectedAppsDuringWork['*']}">
                        <input 
                          type="checkbox" 
                          ng-model="selectedAppsDuringWork[app.pkg]" 
                          ng-change="toggleIndividualAppDuringWork(app.pkg)"
                          ng-disabled="selectedAppsDuringWork['*']">
                        <span style="margin-left: 5px;">
                          <strong>{{app.name || app.pkg}}</strong>
                          <br>
                          <small style="color: #666;">{{app.pkg}}</small>
                        </span>
                      </label>
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label>Allowed outside work <span class="badge">{{countSelected(selectedAppsOutsideWork)}}</span></label>
                  <p class="help-block" style="margin-top: 5px; margin-bottom: 10px;">
                    Select apps that can be used outside work hours, or select "All Apps" to allow everything.
                  </p>
                  
                  <div ng-if="appsLoading" style="text-align: center; padding: 20px;">
                    <i class="fa fa-spinner fa-spin" style="font-size: 24px;"></i>
                    <p>Loading applications...</p>
                  </div>
                  
                  <div ng-if="!appsLoading">
                    <!-- Search box -->
                    <input 
                      type="text" 
                      class="form-control" 
                      ng-model="outsideWorkSearchText" 
                      placeholder="Search apps..."
                      style="margin-bottom: 10px;">
                    
                    <!-- App list container -->
                    <div style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px; background: #fafafa;">
                      <!-- All apps option -->
                      <label class="checkbox" style="margin-bottom: 8px; padding: 8px; background: #fff; border-radius: 4px; display: block; cursor: pointer;">
                        <input 
                          type="checkbox" 
                          ng-model="selectedAppsOutsideWork['*']" 
                          ng-change="toggleAllAppsOutsideWork()">
                        <strong style="margin-left: 5px;">All Apps</strong>
                      </label>
                      
                      <hr style="margin: 10px 0;">
                      
                      <!-- Individual apps -->
                      <div ng-if="applications.length === 0" style="padding: 20px; text-align: center; color: #999;">
                        No applications found
                      </div>
                      
                      <label 
                        class="checkbox" 
                        ng-repeat="app in getFilteredAppsOutsideWork()"
                        style="margin-bottom: 5px; padding: 8px; background: #fff; border-radius: 4px; display: block; cursor: pointer;"
                        ng-class="{'text-muted': selectedAppsOutsideWork['*']}">
                        <input 
                          type="checkbox" 
                          ng-model="selectedAppsOutsideWork[app.pkg]" 
                          ng-change="toggleIndividualAppOutsideWork(app.pkg)"
                          ng-disabled="selectedAppsOutsideWork['*']">
                        <span style="margin-left: 5px;">
                          <strong>{{app.name || app.pkg}}</strong>
                          <br>
                          <small style="color: #666;">{{app.pkg}}</small>
                        </span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Buttons -->
              <div class="form-actions text-right">
                <button class="btn btn-default" ng-click="refresh()">
                  Reload
                </button>
                <button class="btn btn-success" ng-click="save()">
                  <i class="glyphicon glyphicon-floppy-disk"></i>
                  Save Policy
                </button>
              </div>

            </form>

          </div>
        </div>
      </div>
    </div>
  </div>

</div>
